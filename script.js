 var sequences = {'H2A':{'seq':'TRSSRAGLQFPVGRVHRLLRKGNYAERVGAGAPVYLAAVLEYLTAEILELAGNAARDNKKTRIIPRHLQLAVRNDEELNKLLGRVTIAQGGVLPNIQSVLLPK',
                         'features':[{'kind': 'ptm','loc': 0,'resid': 16,'segid': 'C','energy': -47.56,'mutation': 'H2AT16ph'}
                                     ,{'kind': 'ptm','loc': 2,'resid': 18,'segid': 'C','energy': -41.36,'mutation': 'H2AS18ph'},
                                     {'kind': 'ptm','loc': 3,'resid': 19,'segid': 'C','energy': -50.37,'mutation': 'H2AS19ph'},
                                     {'kind': 'ptm','loc': 23,'resid': 39,'segid': 'C','energy': -40.44,'mutation': 'H2AY39ph'},
                                     {'kind': 'ptm', 'loc': 34, 'resid': 50, 'segid': 'C', 'energy': -37.28, 'mutation': 'H2AY50ph'},
                                     {'kind': 'ptm', 'loc': 41, 'resid': 57, 'segid': 'C', 'energy': -31.36, 'mutation': 'H2AY57ph'},
                                     {'kind': 'ptm', 'loc': 43, 'resid': 59, 'segid': 'C', 'energy': -19.6, 'mutation': 'H2AT59ph'},
                                     {'kind': 'ptm', 'loc': 60, 'resid': 76, 'segid': 'C', 'energy': -49.31, 'mutation': 'H2AT76ph'},
                                     {'kind': 'ptm', 'loc': 85, 'resid': 101, 'segid': 'C', 'energy': -49.38, 'mutation': 'H2AT101ph'},
                                     {'kind': 'ptm', 'loc': 97, 'resid': 113, 'segid': 'C', 'energy': -50.12, 'mutation': 'H2AS113ph'}]},
                 'H2B':{'seq':'KTRKESYAIYVYKVLKQVHPDTGISSKAMSIMNSFVNDVFERIAGEASRLAHYNKRSTITSREIQTAVRLLLPGELAKHAVSEGTKAVTKYTSA',
                       'features':[{'kind': 'ptm','loc': 1,'resid': 29,'segid': 'D','energy': -51.47,'mutation': 'H2BT29ph'},
                                   {'kind': 'ptm', 'loc': 5, 'resid': 33, 'segid': 'D', 'energy': -36.7, 'mutation': 'H2BS33ph'},
                                   {'kind': 'ptm', 'loc': 6, 'resid': 34, 'segid': 'D', 'energy': -42.34, 'mutation': 'H2BY34ph'},
                                   {'kind': 'ptm', 'loc': 9, 'resid': 37, 'segid': 'D', 'energy': -41.91, 'mutation': 'H2BY37ph'},
                                   {'kind': 'ptm', 'loc': 11, 'resid': 39, 'segid': 'D', 'energy': -44.84, 'mutation': 'H2BY39ph'},
                                   {'kind': 'ptm', 'loc': 21, 'resid': 49, 'segid': 'D', 'energy': -50.56, 'mutation': 'H2BT49ph'},
                                   {'kind': 'ptm', 'loc': 24, 'resid': 52, 'segid': 'D', 'energy': -49.28, 'mutation': 'H2BS52ph'},
                                   {'kind': 'ptm', 'loc': 25, 'resid': 53, 'segid': 'D', 'energy': -47.5, 'mutation': 'H2BS53ph'},
                                   {'kind': 'ptm', 'loc': 29, 'resid': 57, 'segid': 'D', 'energy': -44.74, 'mutation': 'H2BS57ph'},
                                   {'kind': 'ptm', 'loc': 33, 'resid': 61, 'segid': 'D', 'energy': -34.01, 'mutation': 'H2BS61ph'},
                                   {'kind': 'ptm', 'loc': 47, 'resid': 75, 'segid': 'D', 'energy': -42.93, 'mutation': 'H2BS75ph'},
                                   {'kind': 'ptm', 'loc': 52, 'resid': 80, 'segid': 'D', 'energy': -34.64, 'mutation': 'H2BY80ph'},
                                   {'kind': 'ptm', 'loc': 56, 'resid': 84, 'segid': 'D', 'energy': -44.65, 'mutation': 'H2BS84ph'},
                                   {'kind': 'ptm', 'loc': 57, 'resid': 85, 'segid': 'D', 'energy': -38.26, 'mutation': 'H2BT85ph'},
                                   {'kind': 'ptm', 'loc': 59, 'resid': 87, 'segid': 'D', 'energy': -45.5, 'mutation': 'H2BT87ph'},
                                   {'kind': 'ptm', 'loc': 60, 'resid': 88, 'segid': 'D', 'energy': -52.39, 'mutation': 'H2BS88ph'},
                                   {'kind': 'ptm', 'loc': 65, 'resid': 93, 'segid': 'D', 'energy': -47.68, 'mutation': 'H2BT93ph'},
                                   {'kind': 'ptm', 'loc': 81, 'resid': 109, 'segid': 'D', 'energy': -49.71, 'mutation': 'H2BS109ph'},
                                   {'kind': 'ptm', 'loc': 84, 'resid': 112, 'segid': 'D', 'energy': -45.16, 'mutation': 'H2BT112ph'},
                                   {'kind': 'ptm', 'loc': 88, 'resid': 116, 'segid': 'D', 'energy': -48.7, 'mutation': 'H2BT116ph'},
                                   {'kind': 'ptm', 'loc': 90, 'resid': 118, 'segid': 'D', 'energy': -36.58, 'mutation': 'H2BY118ph'},
                                   {'kind': 'ptm', 'loc': 91, 'resid': 119, 'segid': 'D', 'energy': -48.78, 'mutation': 'H2BT119ph'},
                                   {'kind': 'ptm', 'loc': 92, 'resid': 120, 'segid': 'D', 'energy': -47.47, 'mutation': 'H2BS120ph'}]},
                 'H3':{'seq':'PHRYRPGTVALREIRRYQKSTELLIRKLPFQRLVREIAQDFKTDLRFQSSAVMALQEASEAYLVALFEDTNLCAIHAKRVTIMPKDIQLARRIRGER',
                       'features':[{'kind': 'ptm','loc': 3,'resid': 41,'segid': 'A','energy': -36.01,'mutation': 'H3Y41ph'},
                                   {'kind': 'ptm', 'loc': 7, 'resid': 45, 'segid': 'A', 'energy': -37.89, 'mutation': 'H3T45ph'},
                                   {'kind': 'ptm', 'loc': 16, 'resid': 54, 'segid': 'A', 'energy': -47.03, 'mutation': 'H3Y54ph'},
                                   {'kind': 'ptm', 'loc': 19, 'resid': 57, 'segid': 'A', 'energy': -53.79, 'mutation': 'H3S57ph'},
                                   {'kind': 'ptm', 'loc': 20, 'resid': 58, 'segid': 'A', 'energy': -51.51, 'mutation': 'H3T58ph'},
                                   {'kind': 'ptm', 'loc': 42, 'resid': 80, 'segid': 'A', 'energy': -44.38, 'mutation': 'H3T80ph'},
                                   {'kind': 'ptm', 'loc': 48, 'resid': 86, 'segid': 'A', 'energy': -52.15, 'mutation': 'H3S86ph'},
                                   {'kind': 'ptm', 'loc': 49, 'resid': 87, 'segid': 'A', 'energy': -48.08, 'mutation': 'H3S87ph'},
                                   {'kind': 'ptm', 'loc': 58, 'resid': 96, 'segid': 'A', 'energy': -40.4, 'mutation': 'H3S96ph'},
                                   {'kind': 'ptm', 'loc': 61, 'resid': 99, 'segid': 'A', 'energy': -45.42, 'mutation': 'H3Y99ph'},
                                   {'kind': 'ptm', 'loc': 69, 'resid': 107, 'segid': 'A', 'energy': -25.87, 'mutation': 'H3T107ph'},
                                   {'kind': 'ptm', 'loc': 80, 'resid': 118, 'segid': 'A', 'energy': -41.62, 'mutation': 'H3T118ph'}]},
                 'H4':{'seq':'KVLRDNIQGITKPAIRRLARRGGVKRISGLIYEETRGVLKVFLENVIRDAVTYTEHAKRKTVTAMDVVYALKRQGRTLYGFG',
                       'features':[{'kind': 'ptm','loc': 10,'resid': 30,'segid': 'B','energy': -41.94,'mutation': 'H4T30ph'},
                                   {'kind': 'ptm', 'loc': 27, 'resid': 47, 'segid': 'B', 'energy': -41.36, 'mutation': 'H4S47ph'},
                                   {'kind': 'ptm', 'loc': 31, 'resid': 51, 'segid': 'B', 'energy': -45.87, 'mutation': 'H4Y51ph'},
                                   {'kind': 'ptm', 'loc': 34, 'resid': 54, 'segid': 'B', 'energy': -35.06, 'mutation': 'H4T54ph'},
                                   {'kind': 'ptm', 'loc': 51, 'resid': 71, 'segid': 'B', 'energy': -52.5, 'mutation': 'H4T71ph'},
                                   {'kind': 'ptm', 'loc': 52, 'resid': 72, 'segid': 'B', 'energy': -34.23, 'mutation': 'H4Y72ph'},
                                   {'kind': 'ptm', 'loc': 53, 'resid': 73, 'segid': 'B', 'energy': -39.13, 'mutation': 'H4T73ph'},
                                   {'kind': 'ptm', 'loc': 60, 'resid': 80, 'segid': 'B', 'energy': -37.84, 'mutation': 'H4T80ph'},
                                   {'kind': 'ptm', 'loc': 62, 'resid': 82, 'segid': 'B', 'energy': -43.99, 'mutation': 'H4T82ph'},
                                   {'kind': 'ptm', 'loc': 68, 'resid': 88, 'segid': 'B', 'energy': -35.24, 'mutation': 'H4Y88ph'},
                                   {'kind': 'ptm', 'loc': 76, 'resid': 96, 'segid': 'B', 'energy': -50.45, 'mutation': 'H4T96ph'},
                                   {'kind': 'ptm', 'loc': 78, 'resid': 98, 'segid': 'B', 'energy': -32.22, 'mutation': 'H4Y98ph'}]},
                 
              }

var colors = {'H2A':'rgb(214, 217, 137)','H2B':'rgb(217, 137, 137)',
              'H3':'rgb(148, 180, 209)','H4':'rgb(148, 209, 156)',}
colors_for_table = {'low_en':'rgb(238, 255, 232)', 'high_en':'rgb(250, 223, 220)'}
document.addEventListener("DOMContentLoaded", function ()  {
      window.stage = new NGL.Stage("viewport",{ backgroundColor:"#FFFFFF" });
      window.stage.setParameters({cameraType: "orthographic"});
      window.stage.loadFile("hfile_all_in_core_Repair.pdb").then(function (nucl) {
        var aspectRatio = 2;
        var radius = 1.5;

        nucl.addRepresentation('cartoon', {
           "sele": ":A :E", "color": 0x94b4d1,"aspectRatio":aspectRatio, "radius":radius,"radiusSegments":1,"capped":0 });
        nucl.addRepresentation('cartoon', {
           "sele": ":B :F", "color": 0x94d19c,"aspectRatio":aspectRatio, "radius":radius,"radiusSegments":1,"capped":0 });
        nucl.addRepresentation('cartoon', {
           "sele": ":C :G", "color": 0xd6d989,"aspectRatio":aspectRatio, "radius":radius,"radiusSegments":1,"capped":0 });
        nucl.addRepresentation('cartoon', {
           "sele": ":D :H", "color": 0xd98989,"aspectRatio":aspectRatio, "radius":radius,"radiusSegments":1,"capped":0 });
        nucl.addRepresentation('cartoon', {
           "sele": "nucleic", "color": 0xd6d6d6,"aspectRatio":aspectRatio, "radius":radius,"radiusSegments":1,"capped":0 });
        nucl.addRepresentation('base', {
           "sele": "nucleic", "color": 0xd6d6d6});
        nucl.autoView();

        // window.stage.animationControls.rotate([ 0.5, 0.5, 0, 0.7071068 ],0);
        const to_rad = 3.14159265359/180
        window.stage.viewerControls.spin([1,0,0],-90*to_rad)
        
        window.stage.viewerControls.spin([0,0,1],180*to_rad)
        window.stage.viewerControls.spin([0,1,0],12*to_rad)

   var mutations_names = ['H3S57ph', 'H4T71ph', 'H2BS88ph', 'H3S86ph', 'H2BT29ph', 'H3T58ph', 'H2BT49ph', 'H4T96ph', 'H2AS19ph', 'H2AS113ph', 'H2BS109ph', 'H2AT101ph', 'H2AT76ph', 'H2BS52ph', 'H2BT119ph', 'H2BT116ph', 'H3S87ph', 'H2BT93ph', 'H2AT16ph', 'H2BS53ph', 'H2BS120ph', 'H3Y54ph', 'H4Y51ph', 'H2BT87ph', 'H3Y99ph', 'H2BT112ph', 'H2BY39ph', 'H2BS57ph', 'H2BS84ph', 'H3T80ph', 'H4T82ph', 'H2BS75ph', 'H2BY34ph', 'H4T30ph', 'H2BY37ph', 'H3T118ph', 'H2AS18ph', 'H4S47ph', 'H2AY39ph', 'H3S96ph', 'H4T73ph', 'H2BT85ph', 'H3T45ph', 'H4T80ph', 'H2AY50ph', 'H2BS33ph', 'H2BY118ph', 'H3Y41ph', 'H4Y88ph', 'H4T54ph', 'H2BY80ph', 'H4Y72ph', 'H2BS61ph', 'H4Y98ph', 'H2AY57ph', 'H3T107ph', 'H2AT59ph'];
var energies = [-53.79, -52.5, -52.39, -52.15, -51.77, -51.51, -50.56, -50.45, -50.37, -50.12, -49.71, -49.38, -49.31, -49.28, -48.78, -48.7, -48.08, -47.68, -47.56, -47.5, -47.47, -47.03, -45.87, -45.5, -45.42, -45.16, -44.84, -44.74, -44.65, -44.38, -43.99, -42.93, -42.34, -41.94, -41.91, -41.62, -41.37, -41.36, -40.44, -40.4, -39.13, -38.26, -37.89, -37.84, -37.28, -36.7, -36.58, -36.01, -35.24, -35.06, -34.64, -34.23, -34.01, -32.22, -31.36, -25.87, -19.6];
 var e_threshold = -44.57;
        
 var existed_mutations = ['H2AS1ph','H2AT120ph','H2BS14ph','H3S10ph','H3S28ph','H3S31ph','H3S6ph','H3T11ph','H3T3ph','H3T45ph','H3T80ph','H3Y41ph','H4S1ph', 'H2BS76ph', 'H2BS88ph','H2BT89ph','H2BS92ph','H2BS113ph','H3S86ph','H3T107ph','H3T118ph','H4S47ph','H4Y88ph',]       
        
 var energies_div = document.getElementById("table");
        let table = document.createElement("table");
        let thead = document.createElement("thead");
        let tbody = document.createElement("tbody");
        table.appendChild(thead);
        table.appendChild(tbody);
        
        energies_div.appendChild(table);
        
        let row_0 = document.createElement('tr');
        let heading_1 = document.createElement('th');
        heading_1.innerHTML = "Mutation";
        let heading_2 = document.createElement('th');
        heading_2.innerHTML = "Energy, kkal/mol";
        row_0.appendChild(heading_1);
        row_0.appendChild(heading_2);
        thead.appendChild(row_0);
        
        for (let n = 0; n < mutations_names.length; n++) {
          let row = document.createElement('tr');
          row.id = mutations_names[n]

          let row_mutation = document.createElement('td');
          if (existed_mutations.includes(mutations_names[n]))
              {row_mutation.innerHTML = '*' + mutations_names[n]}
          else {row_mutation.innerHTML = mutations_names[n]};
          let row_energy = document.createElement('td');
          row_energy.innerHTML = energies[n];
          if (energies[n] <= e_threshold) {row.style.backgroundColor = colors_for_table['low_en']; row.bc = 'low'} else {row.style.backgroundColor = colors_for_table['high_en']; row.bc = 'high'}
          
          row.appendChild(row_mutation);
          row.appendChild(row_energy);
          
          tbody.appendChild(row)};


  var seq_div = document.getElementById("sequences");
  let unique_location = 0;

  for (const [hist_name, seq_dict] of Object.entries(sequences)) {
    // seq_div.innerHTML += '<p>'+  hist_name + ':</p>';
    var container = document.createElement("p");
    //var locations_container = document.createElement("p");
    container.appendChild(document.createTextNode(hist_name + ':'));
    seq_div.appendChild(container);

    var residue_spans = [];
    var seq_length = seq_dict['seq'].length
    var first_loc = seq_dict['features'][0]['resid']
    console.log(seq_length)

    for (let c of seq_dict['seq']) {
      //console.log(seq_dict['seq'])
      var container = document.createElement("span");
      container.onselectstart = function(){
                                            return false;
                                          }
      var text = document.createTextNode(c);
      container.appendChild(text);
      container.style.color = "black";
      container.style.background = colors[hist_name];
      container.style.cursor = 'default'
      container.style.fontFamily = 'monospace'

      residue_spans.push(container);
      seq_div.appendChild(container);
      
    };
    
    
    for (const feature of seq_dict['features']) {
      let letter = residue_spans[feature['loc']]
      letter.title = 'E = ' + feature['energy'] + ', resid ' + feature['resid'];
      letter.style.cursor = "pointer";
      letter.style.color = "white";
      letter.style.fontWeight = "bold";
      letter.loc = feature['loc']; 
      letter.mut = feature['mutation'];
      
      //unique_location++
      //letter.unique_location = (unique_location-1);
      
      //console.log(letter.unique_location + ' ' + typeof(letter.unique_location));
      
      letter.highlight_sel = nucl.addRepresentation('hyperball', {'sele':feature['resid'].toString() +":"+ feature['segid'],
                                                               "color":'red',
                                                               "radius":5}) ;           
      letter.highlight_sel.setVisibility(false);
      letter.onclick = function() {
        var state = letter.highlight_sel.getVisibility();
        letter.highlight_sel.setVisibility( !state );
        var table_element = document.getElementById(letter.mut);

        if (!state) {


          letter.style.background = "lime";
          table_element.style.backgroundColor = "lime";
        }
        else {letter.style.background = colors[hist_name];
              
        if (parseFloat(table_element.children[1].textContent) <= e_threshold) {
          table_element.style.backgroundColor = colors_for_table['low_en'];
        } else {
          table_element.style.backgroundColor = colors_for_table['high_en'];
        }

             };
      };

    };
//      var locations_container = //document.createElement("span")
//
//      var numbers = [];
//      for (var i = first_loc; i< seq_length+20;i += 10) //{numbers.push(i)};
//      var locations  = //document.createTextNode(numbers.join('\xa0\xa0\xa0\xa0\xa0\xa//0\xa0\xa0'));
//      locations_container.appendChild(locations);
//      locations_container.style.fontFamily = 'monospace'
//      //locations_container.style.fontSize = 'smaller'
//      seq_div.innerHTML += '<br>';
//      seq_div.appendChild(locations_container);
  };

        
}); 
  
  
});
                
