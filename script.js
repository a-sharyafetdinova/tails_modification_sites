var sequences = {'H2A':{'seq':'TRSSRAGLQFPVGRVHRLLRKGNYAERVGAGAPVYLAAVLEYLTAEILELAGNAARDNKKTRIIPRHLQLAVRNDEELNKLLGRVTIAQGGVLPNIQSVLLPK',
                       'features':[{'kind':'ptm','loc':0,'resid':16,'segid':'C'},
                                  {'kind':'ptm','loc':2,'resid':18,'segid':'C'},
                                  {'kind':'ptm','loc':3,'resid':19,'segid':'C'},
                                  {'kind':'ptm','loc':23,'resid':39,'segid':'C'},
                                  {'kind':'ptm','loc':34,'resid':50,'segid':'C'},
                                  {'kind':'ptm','loc':41,'resid':57,'segid':'C'},
                                  {'kind':'ptm','loc':43,'resid':59,'segid':'C'},
                                  {'kind':'ptm','loc':60,'resid':76,'segid':'C'},
                                  {'kind':'ptm','loc':85,'resid':101,'segid':'C'},
                                  {'kind':'ptm','loc':97,'resid':113,'segid':'C'}]},
                 'H2B':{'seq':'KTRKESYAIYVYKVLKQVHPDTGISSKAMSIMNSFVNDVFERIAGEASRLAHYNKRSTITSREIQTAVRLLLPGELAKHAVSEGTKAVTKYTSA',
                       'features':[{'kind': 'ptm', 'loc': 1, 'resid': 29, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 5, 'resid': 33, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 6, 'resid': 34, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 9, 'resid': 37, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 11, 'resid': 39, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 21, 'resid': 49, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 24, 'resid': 52, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 25, 'resid': 53, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 29, 'resid': 57, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 33, 'resid': 61, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 47, 'resid': 75, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 52, 'resid': 80, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 56, 'resid': 84, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 57, 'resid': 85, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 59, 'resid': 87, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 60, 'resid': 88, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 65, 'resid': 93, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 81, 'resid': 109, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 84, 'resid': 112, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 88, 'resid': 116, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 90, 'resid': 118, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 91, 'resid': 119, 'segid': 'D'},
                                 {'kind': 'ptm', 'loc': 92, 'resid': 120, 'segid': 'D'}]},
                 'H3':{'seq':'PHRYRPGTVALREIRRYQKSTELLIRKLPFQRLVREIAQDFKTDLRFQSSAVMALQEASEAYLVALFEDTNLCAIHAKRVTIMPKDIQLARRIRGER',
                       'features':[{'kind': 'ptm', 'loc': 3, 'resid': 41, 'segid': 'A'},
                                 {'kind': 'ptm', 'loc': 7, 'resid': 45, 'segid': 'A'},
                                 {'kind': 'ptm', 'loc': 16, 'resid': 54, 'segid': 'A'},
                                 {'kind': 'ptm', 'loc': 19, 'resid': 57, 'segid': 'A'},
                                 {'kind': 'ptm', 'loc': 20, 'resid': 58, 'segid': 'A'},
                                 {'kind': 'ptm', 'loc': 42, 'resid': 80, 'segid': 'A'},
                                 {'kind': 'ptm', 'loc': 48, 'resid': 86, 'segid': 'A'},
                                 {'kind': 'ptm', 'loc': 49, 'resid': 87, 'segid': 'A'},
                                 {'kind': 'ptm', 'loc': 58, 'resid': 96, 'segid': 'A'},
                                 {'kind': 'ptm', 'loc': 61, 'resid': 99, 'segid': 'A'},
                                 {'kind': 'ptm', 'loc': 69, 'resid': 107, 'segid': 'A'},
                                 {'kind': 'ptm', 'loc': 80, 'resid': 118, 'segid': 'A'}]},
                 'H4':{'seq':'KVLRDNIQGITKPAIRRLARRGGVKRISGLIYEETRGVLKVFLENVIRDAVTYTEHAKRKTVTAMDVVYALKRQGRTLYGFG',
                       'features':[{'kind': 'ptm', 'loc': 10, 'resid': 30, 'segid': 'B'},
                                 {'kind': 'ptm', 'loc': 27, 'resid': 47, 'segid': 'B'},
                                 {'kind': 'ptm', 'loc': 31, 'resid': 51, 'segid': 'B'},
                                 {'kind': 'ptm', 'loc': 34, 'resid': 54, 'segid': 'B'},
                                 {'kind': 'ptm', 'loc': 51, 'resid': 71, 'segid': 'B'},
                                 {'kind': 'ptm', 'loc': 52, 'resid': 72, 'segid': 'B'},
                                 {'kind': 'ptm', 'loc': 53, 'resid': 73, 'segid': 'B'},
                                 {'kind': 'ptm', 'loc': 60, 'resid': 80, 'segid': 'B'},
                                 {'kind': 'ptm', 'loc': 62, 'resid': 82, 'segid': 'B'},
                                 {'kind': 'ptm', 'loc': 68, 'resid': 88, 'segid': 'B'},
                                 {'kind': 'ptm', 'loc': 76, 'resid': 96, 'segid': 'B'},
                                 {'kind': 'ptm', 'loc': 78, 'resid': 98, 'segid': 'B'}]},
                 
              }

var colors = {'H2A':'rgb(214, 217, 137)','H2B':'rgb(217, 137, 137)',
              'H3':'rgb(148, 180, 209)','H4':'rgb(148, 209, 156)',}
document.addEventListener("DOMContentLoaded", function ()  {
      window.stage = new NGL.Stage("viewport",{ backgroundColor:"#FFFFFF" });
      window.stage.setParameters({cameraType: "orthographic"});
      window.stage.loadFile("file_all_in_core_Repair.pdb").then(function (nucl) {
        var aspectRatio = 2;
        var radius = 1.5;

        nucl.addRepresentation('cartoon', {
           "sele": ":A :E", "color": 0x94b4d1,"aspectRatio":aspectRatio, "radius":radius,"radiusSegments":1,"capped":0 });
        nucl.addRepresentation('cartoon', {
           "sele": ":B :F", "color": 0x94d19c,"aspectRatio":aspectRatio, "radius":radius,"radiusSegments":1,"capped":0 });
        nucl.addRepresentation('cartoon', {
           "sele": ":C :G", "color": 0xd6d989,"aspectRatio":aspectRatio, "radius":radius,"radiusSegments":1,"capped":0 });
        nucl.addRepresentation('cartoon', {
           "sele": ":D :H", "color": 0xd98989,"aspectRatio":aspectRatio, "radius":radius,"radiusSegments":1,"capped":0 });
        nucl.addRepresentation('cartoon', {
           "sele": "nucleic", "color": 0xd6d6d6,"aspectRatio":aspectRatio, "radius":radius,"radiusSegments":1,"capped":0 });
        nucl.addRepresentation('base', {
           "sele": "nucleic", "color": 0xd6d6d6});
        nucl.autoView();

        // window.stage.animationControls.rotate([ 0.5, 0.5, 0, 0.7071068 ],0);
        const to_rad = 3.14159265359/180
        window.stage.viewerControls.spin([1,0,0],-90*to_rad)
        
        window.stage.viewerControls.spin([0,0,1],180*to_rad)
        window.stage.viewerControls.spin([0,1,0],12*to_rad)

        

  var seq_div = document.getElementById("sequences");
  for (const [hist_name, seq_dict] of Object.entries(sequences)) {
    // seq_div.innerHTML += '<p>'+  hist_name + ':</p>';
    var container = document.createElement("p");
    container.appendChild(document.createTextNode(hist_name));
    seq_div.appendChild(container);

    var residue_spans = [];
    
    
    for (let c of seq_dict['seq']) {
      var container = document.createElement("span");
      container.onselectstart = function(){
                                            return false;
                                          }
      var text = document.createTextNode(c);
      container.appendChild(text);
      container.style.color = "black";
      container.style.background = colors[hist_name];
      container.style.cursor = 'default'
      container.style.fontFamily = 'monospace'
      residue_spans.push(container);
      seq_div.appendChild(container);
    };
    for (const feature of seq_dict['features']) {
      let letter = residue_spans[feature['loc']]
      letter.style.cursor = "pointer";
      letter.style.color = "red";
      // letter.loc = feature['loc'];
      
      letter.highlight_sel = nucl.addRepresentation('hyperball', {'sele':feature['resid'].toString() +":"+ feature['segid'] + 'and not _H' ,
                                                               "color":'red',
                                                               "radius":5}) ;           
      letter.highlight_sel.setVisibility(false);
      letter.onclick = function() {
        var state = letter.highlight_sel.getVisibility();
        letter.highlight_sel.setVisibility( !state );
        letter.style.background = !state? "lime" : colors[hist_name];
      };
    }
  }
  
}); 
});
                
